<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Lista de Aventuras Compartida</title>
  <style>
    body { font-family: 'Courier New', monospace; background: #111; color: #0f0; padding: 20px; }
    input, button { margin: 5px; }
    .tarea { margin-top: 10px; }
  </style>
</head>
<body>

  <h1>🌈 Lista de Aventuras Compartida</h1>

  <input type="text" id="inputTarea" placeholder="Nueva aventura..." />
  <button onclick="agregarTarea()">Agregar</button>

  <div id="listaTareas"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://ymjwxtplspzlrubomexg.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inltand4dHBsc3B6bHJ1Ym9tZXhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQzMzY4NDksImV4cCI6MjA1OTkxMjg0OX0.UQrCoDBqrjJsiPzP_cZcw5Tt4HhPZQOnpNUqS5eqYK4'
    const supabase = createClient(supabaseUrl, supabaseKey)

    async function cargarTareas() {
      const { data, error } = await supabase
        .from('tareas')
        .select('*')
        .order('id', { ascending: true })

      if (error) {
        console.error(error)
        return
      }

      const contenedor = document.getElementById('listaTareas')
      contenedor.innerHTML = ''
      data.forEach(tarea => {
        const div = document.createElement('div')
        div.className = 'tarea'
        div.innerHTML = `
          <input type="checkbox" ${tarea.completada ? 'checked' : ''} onchange="toggleTarea(${tarea.id}, this.checked)">
          ${tarea.titulo}
          <button onclick="borrarTarea(${tarea.id})">🗑️</button>
        `
        contenedor.appendChild(div)
      })
    }

    async function agregarTarea() {
      const input = document.getElementById('inputTarea')
      const titulo = input.value
      if (!titulo) return

      const { error } = await supabase
        .from('tareas')
        .insert([{ titulo, completada: false }])

      if (error) console.error(error)
      input.value = ''
      cargarTareas()
    }

    async function toggleTarea(id, completada) {
      const { error } = await supabase
        .from('tareas')
        .update({ completada })
        .eq('id', id)

      if (error) console.error(error)
      cargarTareas()
    }

    async function borrarTarea(id) {
      const { error } = await supabase
        .from('tareas')
        .delete()
        .eq('id', id)

      if (error) console.error(error)
      cargarTareas()
    }

    // Cargar tareas al inicio
    cargarTareas()
  </script>
</body>
</html>
